```{r setupinst, include=FALSE}
knitr::opts_chunk$set(echo = FALSE, 
                      fig.width = 7,
                      fig.height = 4,
                      fig.align = 'left')
library(ggplot2)
library(tidyverse)
library(readxl)
library(dplyr)

source('gradu_read_data.R', encoding = 'UTF-8')
```

# Instrument {#inst}

In this chapter, I present the identification strategy of the instrument variable that will be used to identify the structural shock of the SVAR model discussed in Chapter \@ref(econometrics). The structure of the chapter is as follows. The first subchapter is for introduces a simplistic model of the futures markets. Second, I will explain how based on this model, high-frequency identification can be used to extract information about the changes in the carbon policy regime. Third, I will present the observed values of the carbon policy surprise series. The last part analyses the surprise series and its fitness as an instrumental variable.

## Futures market

The usage of futures markets relies on the hypothesis that the markets will effectively incorporate all available information into the price discovery mechanism [@hayek35v]. The futures are the markets' best guess for the future price of these carbon permits, given there are no transportation costs, and the risk tolerance of the seller and buyer are equal \citep{nakamura2018}

Standard theory on asset price formation formulated by @pindyck2001 predicts that futures contracts on a day $d$ with a maturity $h$ are valued as:

\begin{equation}
  F_d^h = \mathbb{E}_d(P_{d+h})-RP^h_d
  (\#eq:futprice)
\end{equation}

The equation \@ref(eq:futprice) describes that the price of a future is a combination of the expected price of the asset $P_{d+h}$ with the information available on the date $d$ and the risk premium $RP$ to time step $h$ at time step $d$. 

## High-frequency identification

Following the approach of the high-frequency identification of the instrument used by @kaenzig2022. Similar approach that @romer2010macroeconomic used and @kaenzig2021 in his previous research on the consequences of the OPEC announcements. The surprise series of the carbon futures market is calculated from the log differences in the daily closing price of the EU emission trading certificate futures.

It can be assumed that because of the tight identification period, the changes in the risk premium are not changing $RP_d \approx RP_{d-1}$ and thus, the surprise series is representing the updates in the expected future price of the emission trading certificates [@kaenzig2021].


\begin{equation}
  \begin{split}
    \text{Surprise}_d &= F^h_d-F^h_{d-1} \\
    &= \mathbb{E}_d(P_{d+h})-RP^h_d-\mathbb{E}_{d-1}(P_{d+h})+RP^h_{d-1} \\
    &= \mathbb{E}_d(P_{d+h})-\mathbb{E}_{d-1}(P_{d+h}) 
  \end{split}
(\#eq:surprise)
\end{equation}


The daily surprise series elaborated in the equation \@ref(eq:surprise) is then aggregated to a monthly carbon policy surprise series. Finally, an indicator function $1_{cp}(d)$ whether a day contains a carbon policy regulatory event is used to mask days with regulatory events to zero. The regulatory events are listed in Appendix \@ref(regdates).

$$
\text{CPSurprise}_m = \sum_{d\in m}\text{CPSurprise}_d 
$$

This monthly surprise series is an ideal external instrument due to the exogeneity resulting from the short time frame of the identification. It can be used as the $z_t$ of Equation \@ref(eq:prop).

## Regulatory Dates {#reggdates}

Identifying regulatory events is a vital part of the building of this instrument. In Figure \@ref(fig:instplot), the values of the $\text{CPSurprise}_m$ are presented, in addition to some exciting named regulatory events.


```{r instplot, warning=FALSE, message=FALSE,fig.cap='Monthly carbon policy surprise series and some policy events that produced substantial market reactions. The dashed line deliniates between the policy surprise produced by \\citet{kaenzig2022} and the researcher.'}

get_useful_data() %>% 
  select(Date, monthly_sum) %>% 
  filter(Date > lubridate::ymd('2005.01.01')) %>% 
  ggplot(aes(x = Date, y = monthly_sum*100))+
  geom_line()+
  geom_vline(xintercept = lubridate::ymd('2018.12.01'), 
             linetype = 'longdash',
             alpha = 0.5)+
  geom_point(x = lubridate::ymd('2007.04.01'),y = -30, size = 2, colour = 'red')+
  annotate('text',
           label = 'Austrian phase II NAP and \nHungarian phase II NAP approved',
           x = lubridate::ymd('2007.04.01'),
           y = -35,
           size = 3)+
  geom_point(x = lubridate::ymd('2007.11.01'), y = 35.66, size = 2, colour = 'red')+
  annotate('text',
           label = 'Court judgement \non German NAP',
           x = lubridate::ymd('2009.06.01'),
           y = 35,
           size = 3)+
  geom_point(x = lubridate::ymd('2013-04-01'), y = -43.20, size = 2, colour = 'red')+
  annotate('text',
           label = 'Parliament voted against back-loading',
           x = lubridate::ymd('2015-04-01'),
           y = -45,
           size =3)+
  geom_point(x = lubridate::ymd('2013-09-01'), y = 10.24, size = 2, colour = 'red')+
  annotate('text',
           label = 'Commission decision on \nfree alloction for phase III',
           x = lubridate::ymd('2013-09-01'),
           y = 15,
           size =3)+
  geom_point(x = lubridate::ymd('2014-03-01'), y = -18.54, size = 2, colour = 'red')+
  annotate('text',
           label = 'Commission approves first \ninternational credits',
           x = lubridate::ymd('2015-08-01'),
           y = -22.5,
           size =3)+
  geom_point(x = lubridate::ymd('2019-01-01'), y = -6.12, size = 2, colour = 'red')+
  annotate('text',
           label = 'ETS Auctioning \nRegulation amendment',
           x = lubridate::ymd('2020-06-01'),
           y = -10,
           size =3)+
  geom_point(x = lubridate::ymd('2021-05-01'), y = 6.55, size = 2, colour = 'red')+
  annotate('text',
           label = 'ETS Market Stability Reserve \nto reduce auction volume',
           x = lubridate::ymd('2020-01-01'),
           y = 15,
           size =3)+
  theme_bw()+
  labs(y = '%',
       x = NULL)

```

All the regulatory dates are listed in the appendix \@ref(regdates). As in Figure \@ref(fig:instplot), the dates produced in @kaenzig2022 and by me are separated.

## Diagnostics of the Surprise as an external instrument {#diagextinst}

One of the significant problems the instrument could have is that it would be serially correlated. There is no evidence of persistent autocorrelation. However, there is a statistically significant autocorrelation, as seen in Figure \@ref(fig:acfplot) after 11 lags, and also evidence of partial autocorrelation can be seen in Figure \@ref(fig:pacfplot). 

```{r acfplot, warning=FALSE, message=FALSE,fig.cap='Autocorrelation plot of the monthly carbon policy surprise.'}

inst <- get_useful_data() %>% 
  select(monthly_sum) %>%
  rename(`Instrument variable` = monthly_sum)

autocorr <- acf(inst, plot = F, lag.max = 36)
  
  plot(autocorr, main = '')

```

```{r pacfplot, warning=FALSE, message=FALSE,fig.cap='Partial autocorrelation plot of the monthly carbon policy surprise.'}
  partial_acf <- pacf(inst, plot = F, lag.max = 36)
  plot(partial_acf, main = '')

```

This autocorrelation of 11 lags would mean that the last year's regulatory announcements correlate with the announcements at time step $t$. This can be seen from Figure \@ref(fig:seasonal-variation). As the announcements are not equally distributed throughout the year, our results may capture some seasonal impacts if the seasonal variation is not adequately handled. This is additional reason to use trend values of the variables and why there is noticeable seasonal fluctuation in the appendix \@ref(seasonapp).


```{r seasonal-variation, message=FALSE, warning=FALSE,fig.cap='A summary of the amoutns of regulatory days by calender month. The total amounts are displayed as numbers above the bar plots. The bars have been colored to correspond the amounts of positive and negative shocks in every month.'}

get_useful_data()%>%
  dplyr::select(Date, monthly_sum) %>%
  group_by(month = lubridate::month(Date)) %>%
  filter(monthly_sum != 0) %>%
  summarise(n = n(),
            pos = sum(monthly_sum>0), 
            neg = sum(monthly_sum<0)) %>%
  pivot_longer(cols = c(pos,neg)) %>%
  ggplot(aes(x = factor(month), y = value)) + 
    geom_col(aes(fill = name),
             colour = 'black') + 
    geom_text(aes(x = floor(seq(1,12.5,0.5)), 
                  y = n+0.7, 
                  label = n), 
              size = 6)+
    theme_bw() + 
    labs(x = 'Month of the year',
         y = 'Number of shocks')+
    scale_fill_brewer(name = '', 
                      labels = c("Negative \nshocks","Positive \nshocks"), 
                      palette= "Pastel1")


```

\newpage